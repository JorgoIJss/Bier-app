"use strict";(()=>{var e={};e.id=898,e.ids=[898],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5900:e=>{e.exports=require("pg")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},3999:(e,t,o)=>{o.r(t),o.d(t,{config:()=>u,default:()=>l,routeModule:()=>c});var r={};o.r(r),o.d(r,{default:()=>i});var a=o(1802),s=o(7153),n=o(6249);let d=new(o(5900)).Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});async function i(e,t){let o=await d.connect();try{switch(e.method){case"GET":{let e=await o.query(`
                    SELECT b.*, COUNT(bv.id) as vote_count
                    FROM beers_gildeavond b
                     LEFT JOIN beer_votes bv ON b.id = bv.beer_id
                     GROUP BY b.id
                    ORDER BY b.prijs;
                `);t.status(200).json(e.rows);break}case"POST":{let{selectedBeers:r,gildeavond_date:a}=e.body;for(let e of r){let r=await o.query("SELECT * FROM beers WHERE id = $1",[e]);if(0===r.rows.length)return t.status(404).json({error:`Beer with id ${e} not found`});let s=r.rows[0],n=await o.query("SELECT id FROM beers_gildeavond WHERE beer_id = $1 AND gildeavond_date = $2",[e,a]);if(0===n.rows.length){await o.query(`INSERT INTO beers_gildeavond (beer_id, naam, brouwer, type, "alcoholpercentage",
                                                            prijs, remark, status, koelkast, gildeavond_date, avg_score, vote_count)
                             VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)`,[e,s.naam,s.brouwer,s.type,s.alcoholpercentage,s.prijs,s.remark,s.status,s.koelkast,a,s.avg_score,s.vote_count]);let t=await o.query("SELECT gildeavond_date FROM Beers_Gildeavond_Date WHERE gildeavond_date = $1",[a]);0===t.rows.length&&await o.query("INSERT INTO Beers_Gildeavond_Date (gildeavond_date) VALUES ($1)",[a])}}t.status(201).json({message:"Beers moved to Gildeavond successfully"});break}case"PATCH":{let{id:r}=e.query,a=e.body;if(console.log("Received PATCH request with id:",r,"and updates:",a),0===Object.keys(a).length)return console.log("No updates provided."),t.status(400).json({error:"No updates provided."});let s=Object.keys(a).map((e,t)=>`"${e}" = $${t+1}`).join(", "),n=`UPDATE beers_gildeavond SET ${s} WHERE id = $${Object.keys(a).length+1} RETURNING *`,d=[...Object.values(a),r];console.log("Executing query:",n,"with values:",d);try{let e=await o.query(n,d);if(0===e.rows.length)return console.log("Beer not found with id:",r),t.status(404).json({error:`Beer with id: ${r} not found`});let a=await o.query(`
                        SELECT b.*, COUNT(bv.id) as vote_count
                        FROM beers_gildeavond b
                        LEFT JOIN beer_votes bv ON b.id = bv.beer_id
                        WHERE b.id = $1
                        GROUP BY b.id
                    `,[r]);console.log("Successfully updated beer with id:",r),t.status(200).json(a.rows[0])}catch(e){console.error("Error during database update:",e),t.status(500).json({error:"Database operation failed",details:e.message})}break}case"DELETE":{let{id:r}=e.query;console.log(`Received DELETE request for beer with id: ${r}`);try{let e=await o.query("DELETE FROM beers_gildeavond WHERE id = $1 RETURNING *",[r]);if(0===e.rows.length)return console.log(`Beer with id: ${r} not found in beers_gildeavond`),t.status(404).json({error:`Beer with id: ${r} not found in beers_gildeavond`});console.log(`Successfully deleted beer with id: ${r}`),t.status(200).json(e.rows[0])}catch(e){console.error("Error during database delete operation:",e),t.status(500).json({error:"Database operation failed",details:e.message})}break}default:t.setHeader("Allow",["GET","POST","PATCH","DELETE"]),t.status(405).end(`Method ${e.method} Not Allowed`)}}catch(e){console.error("Database operation failed:",e),t.status(500).json({error:"Database operation failed",details:e.message})}finally{o.release()}}let l=(0,n.l)(r,"default"),u=(0,n.l)(r,"config"),c=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/gildeavondBeers",pathname:"/api/gildeavondBeers",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=3999);module.exports=o})();